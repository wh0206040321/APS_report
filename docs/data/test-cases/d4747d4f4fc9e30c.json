{"uid":"d4747d4f4fc9e30c","name":"test_imp_update","fullName":"Tests.test_system.test_imp.TestImpPage#test_imp_update","historyId":"6c925cfdaf73b2b37df6c7fddf34649b","time":{"start":1769544909577,"stop":1769544943334,"duration":33757},"status":"failed","statusMessage":"AssertionError: assert ('\\u4fdd\\u5b58\\u6210\\u529f' == '\\u4fdd\\u5b58\\u6210\\u529f'\n  \n  \u001B[0m\u001B[90m \u001B[39;49;00m 保存成功\u001B[90m\u001B[39;49;00m and 2 == 0)\n +  where 2 = len([<selenium.webdriver.remote.webelement.WebElement (session=\"e8908af128f6e6b848b88de41bcb7ace\", element=\"f.3D3B83AC46F58050107F80DDE121A3AC.d.28FC0E7123EB4F09536A1663B51D89EC.e.19307\")>, <selenium.webdriver.remote.webelement.WebElement (session=\"e8908af128f6e6b848b88de41bcb7ace\", element=\"f.3D3B83AC46F58050107F80DDE121A3AC.d.28FC0E7123EB4F09536A1663B51D89EC.e.25683\")>])","statusTrace":"self = <test_system.test_imp.TestImpPage object at 0x00000203BB49BB20>, login_to_imp = <selenium.webdriver.chrome.webdriver.WebDriver (session=\"e8908af128f6e6b848b88de41bcb7ace\")>\n\n    @allure.story(\"编辑方案成功，取消勾选客户，勾选工序成功。右键映射点击确定不报错，点击方案不报错\")\n    # @pytest.mark.run(order=1)\n    def test_imp_update(self, login_to_imp):\n        driver = login_to_imp  # WebDriver 实例\n        imp = ImpPage(driver)  # 用 driver 初始化 ImpPage\n        dir_ = 'Process'\n        name = \"1导入设置方案\"\n        kh = \"客户\"\n        gx = \"工序\"\n        imp.click_button(\n            '//div[@class=\"flex-alignItems-center background-ffffff h-36px w-b-100 m-l-12 toolbar-container\"]//input[@class=\"ivu-select-input\"]')\n        WebDriverWait(driver, 10).until(EC.element_to_be_clickable((By.XPATH, f'//ul/li[text()=\"{name}\"]'))).click()\n        imp.click_button('//ul[@class=\"ivu-tree-children\"]//span[text()=\"导入\"]')\n        imp.click_impall_button(\"编辑\")\n        sleep(1)\n        imp.click_button(f'//ul[@class=\"ivu-tree-children\"]//span[text()=\"{kh}\"]/ancestor::ul[1]//label/span')\n        imp.click_button(f'//ul[@class=\"ivu-tree-children\"]//span[text()=\"{gx}\"]/ancestor::ul[1]//label/span')\n        ele = imp.get_find_element_xpath(f'//ul[@class=\"ivu-tree-children\"]//span[text()=\"{gx}\"]')\n        ActionChains(driver).context_click(ele).perform()\n        imp.click_button('//li[text()=\"映射编辑\"]')\n        imp.click_button('//button[span[text()=\"浏览文件\"]]')\n    \n        # 清理 .crdownload 文件，避免上传未完成的文件\n        current_dir = os.path.dirname(__file__)\n        download_path = os.path.join(current_dir, \"downloads\")\n        for f in os.listdir(download_path):\n            if f.endswith(\".crdownload\"):\n                os.remove(os.path.join(download_path, f))\n    \n        sleep(2)\n        # 1. 准备上传文件路径\n        upload_file = os.path.join(download_path, f\"{dir_}.xls\")\n        assert os.path.isfile(upload_file), f\"❌ 上传文件不存在: {upload_file}\"\n    \n        # 2. 定位上传控件并执行上传\n        imp.get_find_element_xpath('(//input[@type=\"file\"])[3]')\n        pyautogui.write(upload_file)\n        sleep(3)\n        pyautogui.press('enter')\n        sleep(1)\n        pyautogui.press('enter')\n        sleep(1)\n        imp.click_button('//div[text()=\" 字段映射 \"]')\n        sleep(1)\n        imp.wait_for_el_loading_mask()\n        num = len(imp.finds_elements(By.XPATH, '(//table[@class=\"vxe-table--body\"])[1]//tr'))\n        for i in range(1, num + 1):\n            imp.click_button(\n                f'(//table[@class=\"vxe-table--body\"])[1]//tr[{i}]/td[3]')\n            sleep(0.5)\n            imp.click_button(\n                f'(//div[@class=\"vxe-select-option--wrapper\"])[{i}]/div[{i}]')\n            sleep(1)\n    \n        imp.click_button(\n            '(//div[@class=\"vxe-modal--footer\"]//span[text()=\"确定\"])[last()]')\n        imp.click_impall_button(\"保存\")\n        message = imp.get_find_message()\n        imp.click_button('//span[text()=\" 执行方案\"]')\n        imp.click_button('//div[@class=\"ivu-modal-confirm-footer\"]//span[text()=\"确定\"]')\n        imp.get_find_message()\n        imp.wait_for_el_loading_mask()\n        eles1 = imp.finds_elements(By.XPATH,\n                                   f'//ul[@class=\"ivu-tree-children\"]//span[@class=\"valueSpan\" and text()=\"{kh}\"]')\n        eles2 = imp.finds_elements(By.XPATH,\n                                   f'//ul[@class=\"ivu-tree-children\"]//span[@class=\"valueSpan\" and text()=\"{gx}\"]')\n        eles = imp.finds_elements(By.XPATH, '//i[@class=\"ivu-icon ivu-icon-ios-close-circle\"]')\n        assert len(eles) == 0\n>       assert message == \"保存成功\" and len(eles1) == 0 and len(eles2) == 1\nE       assert ('\\u4fdd\\u5b58\\u6210\\u529f' == '\\u4fdd\\u5b58\\u6210\\u529f'\nE         \nE         \u001B[0m\u001B[90m \u001B[39;49;00m 保存成功\u001B[90m\u001B[39;49;00m and 2 == 0)\nE        +  where 2 = len([<selenium.webdriver.remote.webelement.WebElement (session=\"e8908af128f6e6b848b88de41bcb7ace\", element=\"f.3D3B83AC46F58050107F80DDE121A3AC.d.28FC0E7123EB4F09536A1663B51D89EC.e.19307\")>, <selenium.webdriver.remote.webelement.WebElement (session=\"e8908af128f6e6b848b88de41bcb7ace\", element=\"f.3D3B83AC46F58050107F80DDE121A3AC.d.28FC0E7123EB4F09536A1663B51D89EC.e.25683\")>])\n\nTests\\test_system\\test_imp.py:244: AssertionError","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"login_to_imp","time":{"start":1769544848835,"stop":1769544863536,"duration":14701},"status":"passed","steps":[],"attachments":[],"parameters":[],"hasContent":false,"attachmentStep":false,"stepsCount":0,"attachmentsCount":0,"shouldDisplayMessage":false}],"testStage":{"status":"failed","statusMessage":"AssertionError: assert ('\\u4fdd\\u5b58\\u6210\\u529f' == '\\u4fdd\\u5b58\\u6210\\u529f'\n  \n  \u001B[0m\u001B[90m \u001B[39;49;00m 保存成功\u001B[90m\u001B[39;49;00m and 2 == 0)\n +  where 2 = len([<selenium.webdriver.remote.webelement.WebElement (session=\"e8908af128f6e6b848b88de41bcb7ace\", element=\"f.3D3B83AC46F58050107F80DDE121A3AC.d.28FC0E7123EB4F09536A1663B51D89EC.e.19307\")>, <selenium.webdriver.remote.webelement.WebElement (session=\"e8908af128f6e6b848b88de41bcb7ace\", element=\"f.3D3B83AC46F58050107F80DDE121A3AC.d.28FC0E7123EB4F09536A1663B51D89EC.e.25683\")>])","statusTrace":"self = <test_system.test_imp.TestImpPage object at 0x00000203BB49BB20>, login_to_imp = <selenium.webdriver.chrome.webdriver.WebDriver (session=\"e8908af128f6e6b848b88de41bcb7ace\")>\n\n    @allure.story(\"编辑方案成功，取消勾选客户，勾选工序成功。右键映射点击确定不报错，点击方案不报错\")\n    # @pytest.mark.run(order=1)\n    def test_imp_update(self, login_to_imp):\n        driver = login_to_imp  # WebDriver 实例\n        imp = ImpPage(driver)  # 用 driver 初始化 ImpPage\n        dir_ = 'Process'\n        name = \"1导入设置方案\"\n        kh = \"客户\"\n        gx = \"工序\"\n        imp.click_button(\n            '//div[@class=\"flex-alignItems-center background-ffffff h-36px w-b-100 m-l-12 toolbar-container\"]//input[@class=\"ivu-select-input\"]')\n        WebDriverWait(driver, 10).until(EC.element_to_be_clickable((By.XPATH, f'//ul/li[text()=\"{name}\"]'))).click()\n        imp.click_button('//ul[@class=\"ivu-tree-children\"]//span[text()=\"导入\"]')\n        imp.click_impall_button(\"编辑\")\n        sleep(1)\n        imp.click_button(f'//ul[@class=\"ivu-tree-children\"]//span[text()=\"{kh}\"]/ancestor::ul[1]//label/span')\n        imp.click_button(f'//ul[@class=\"ivu-tree-children\"]//span[text()=\"{gx}\"]/ancestor::ul[1]//label/span')\n        ele = imp.get_find_element_xpath(f'//ul[@class=\"ivu-tree-children\"]//span[text()=\"{gx}\"]')\n        ActionChains(driver).context_click(ele).perform()\n        imp.click_button('//li[text()=\"映射编辑\"]')\n        imp.click_button('//button[span[text()=\"浏览文件\"]]')\n    \n        # 清理 .crdownload 文件，避免上传未完成的文件\n        current_dir = os.path.dirname(__file__)\n        download_path = os.path.join(current_dir, \"downloads\")\n        for f in os.listdir(download_path):\n            if f.endswith(\".crdownload\"):\n                os.remove(os.path.join(download_path, f))\n    \n        sleep(2)\n        # 1. 准备上传文件路径\n        upload_file = os.path.join(download_path, f\"{dir_}.xls\")\n        assert os.path.isfile(upload_file), f\"❌ 上传文件不存在: {upload_file}\"\n    \n        # 2. 定位上传控件并执行上传\n        imp.get_find_element_xpath('(//input[@type=\"file\"])[3]')\n        pyautogui.write(upload_file)\n        sleep(3)\n        pyautogui.press('enter')\n        sleep(1)\n        pyautogui.press('enter')\n        sleep(1)\n        imp.click_button('//div[text()=\" 字段映射 \"]')\n        sleep(1)\n        imp.wait_for_el_loading_mask()\n        num = len(imp.finds_elements(By.XPATH, '(//table[@class=\"vxe-table--body\"])[1]//tr'))\n        for i in range(1, num + 1):\n            imp.click_button(\n                f'(//table[@class=\"vxe-table--body\"])[1]//tr[{i}]/td[3]')\n            sleep(0.5)\n            imp.click_button(\n                f'(//div[@class=\"vxe-select-option--wrapper\"])[{i}]/div[{i}]')\n            sleep(1)\n    \n        imp.click_button(\n            '(//div[@class=\"vxe-modal--footer\"]//span[text()=\"确定\"])[last()]')\n        imp.click_impall_button(\"保存\")\n        message = imp.get_find_message()\n        imp.click_button('//span[text()=\" 执行方案\"]')\n        imp.click_button('//div[@class=\"ivu-modal-confirm-footer\"]//span[text()=\"确定\"]')\n        imp.get_find_message()\n        imp.wait_for_el_loading_mask()\n        eles1 = imp.finds_elements(By.XPATH,\n                                   f'//ul[@class=\"ivu-tree-children\"]//span[@class=\"valueSpan\" and text()=\"{kh}\"]')\n        eles2 = imp.finds_elements(By.XPATH,\n                                   f'//ul[@class=\"ivu-tree-children\"]//span[@class=\"valueSpan\" and text()=\"{gx}\"]')\n        eles = imp.finds_elements(By.XPATH, '//i[@class=\"ivu-icon ivu-icon-ios-close-circle\"]')\n        assert len(eles) == 0\n>       assert message == \"保存成功\" and len(eles1) == 0 and len(eles2) == 1\nE       assert ('\\u4fdd\\u5b58\\u6210\\u529f' == '\\u4fdd\\u5b58\\u6210\\u529f'\nE         \nE         \u001B[0m\u001B[90m \u001B[39;49;00m 保存成功\u001B[90m\u001B[39;49;00m and 2 == 0)\nE        +  where 2 = len([<selenium.webdriver.remote.webelement.WebElement (session=\"e8908af128f6e6b848b88de41bcb7ace\", element=\"f.3D3B83AC46F58050107F80DDE121A3AC.d.28FC0E7123EB4F09536A1663B51D89EC.e.19307\")>, <selenium.webdriver.remote.webelement.WebElement (session=\"e8908af128f6e6b848b88de41bcb7ace\", element=\"f.3D3B83AC46F58050107F80DDE121A3AC.d.28FC0E7123EB4F09536A1663B51D89EC.e.25683\")>])\n\nTests\\test_system\\test_imp.py:244: AssertionError","steps":[],"attachments":[{"uid":"87ad32e4e9f8745f","name":"test_imp_update_20260128_041543","source":"87ad32e4e9f8745f.png","type":"image/png","size":106101},{"uid":"e39daef83b2df64c","name":"test_imp_update_20260128_041543","source":"e39daef83b2df64c.png","type":"image/png","size":105968},{"uid":"19b18c7407e5953e","name":"test_imp_update_20260128_041543","source":"19b18c7407e5953e.png","type":"image/png","size":8032},{"uid":"f4c52f1063dbebc","name":"test_imp_update_20260128_041543","source":"f4c52f1063dbebc.png","type":"image/png","size":25802},{"uid":"b13275a57eea8116","name":"test_imp_update_20260128_041543","source":"b13275a57eea8116.png","type":"image/png","size":25802},{"uid":"d09466ea2f2b6a3e","name":"test_imp_update_20260128_041543","source":"d09466ea2f2b6a3e.png","type":"image/png","size":19002},{"uid":"41485dae43a20fd7","name":"test_imp_update_20260128_041543","source":"41485dae43a20fd7.png","type":"image/png","size":25802},{"uid":"1fdbbe43089011b5","name":"test_imp_update_20260128_041544","source":"1fdbbe43089011b5.png","type":"image/png","size":19002},{"uid":"83c8183a1f9f0d65","name":"test_imp_update_20260128_041544","source":"83c8183a1f9f0d65.png","type":"image/png","size":25802},{"uid":"670d6749fce24e64","name":"test_imp_update_20260128_041544","source":"670d6749fce24e64.png","type":"image/png","size":25802},{"uid":"90e2046868327468","name":"test_imp_update_20260128_041544","source":"90e2046868327468.png","type":"image/png","size":19002},{"uid":"bee916feb1d6ad71","name":"test_imp_update_20260128_041544","source":"bee916feb1d6ad71.png","type":"image/png","size":25802},{"uid":"105d3f3fdd77560c","name":"test_imp_update_20260128_041544","source":"105d3f3fdd77560c.png","type":"image/png","size":51850},{"uid":"e5b52ff5f4ed5188","name":"log","source":"e5b52ff5f4ed5188.txt","type":"text/plain","size":5681}],"parameters":[],"hasContent":true,"attachmentStep":false,"stepsCount":0,"attachmentsCount":14,"shouldDisplayMessage":true},"afterStages":[{"name":"login_to_imp::0","time":{"start":1769545030767,"stop":1769545032952,"duration":2185},"status":"passed","steps":[],"attachments":[],"parameters":[],"hasContent":false,"attachmentStep":false,"stepsCount":0,"attachmentsCount":0,"shouldDisplayMessage":false}],"labels":[{"name":"feature","value":"导入设置页用例"},{"name":"story","value":"编辑方案成功，取消勾选客户，勾选工序成功。右键映射点击确定不报错，点击方案不报错"},{"name":"parentSuite","value":"Tests.test_system"},{"name":"suite","value":"test_imp"},{"name":"subSuite","value":"TestImpPage"},{"name":"host","value":"WIN-20240820MJV"},{"name":"thread","value":"11452-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"Tests.test_system.test_imp"},{"name":"resultFormat","value":"allure2"}],"parameters":[],"links":[],"hidden":true,"retry":true,"extra":{"categories":[],"tags":[]},"source":"d4747d4f4fc9e30c.json","parameterValues":[]}