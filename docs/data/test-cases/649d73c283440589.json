{"uid":"649d73c283440589","name":"test_imp_update","fullName":"Tests.test_system.test_imp.TestImpPage#test_imp_update","historyId":"6c925cfdaf73b2b37df6c7fddf34649b","time":{"start":1770328798402,"stop":1770328829153,"duration":30751},"status":"failed","statusMessage":"AssertionError: assert ('\\u4fdd\\u5b58\\u6210\\u529f' == '\\u4fdd\\u5b58\\u6210\\u529f'\n  \n  \u001B[0m\u001B[90m \u001B[39;49;00m 保存成功\u001B[90m\u001B[39;49;00m and 2 == 0)\n +  where 2 = len([<selenium.webdriver.remote.webelement.WebElement (session=\"e6f445d61ee41b2708dff765542abc32\", element=\"f.DE6069D09715D71BC37C618DEE4F4204.d.02812212BC197144D6FF12E1ECFFEF55.e.19363\")>, <selenium.webdriver.remote.webelement.WebElement (session=\"e6f445d61ee41b2708dff765542abc32\", element=\"f.DE6069D09715D71BC37C618DEE4F4204.d.02812212BC197144D6FF12E1ECFFEF55.e.25490\")>])","statusTrace":"self = <test_system.test_imp.TestImpPage object at 0x000001B938328460>, login_to_imp = <selenium.webdriver.chrome.webdriver.WebDriver (session=\"e6f445d61ee41b2708dff765542abc32\")>\n\n    @allure.story(\"编辑方案成功，取消勾选客户，勾选工序成功。右键映射点击确定不报错，点击方案不报错\")\n    # @pytest.mark.run(order=1)\n    def test_imp_update(self, login_to_imp):\n        driver = login_to_imp  # WebDriver 实例\n        imp = ImpPage(driver)  # 用 driver 初始化 ImpPage\n        dir_ = 'Process'\n        name = \"1导入设置方案\"\n        kh = \"客户\"\n        gx = \"工序\"\n        imp.click_button(\n            '//div[@class=\"flex-alignItems-center background-ffffff h-36px w-b-100 m-l-12 toolbar-container\"]//input[@class=\"ivu-select-input\"]')\n        WebDriverWait(driver, 10).until(EC.element_to_be_clickable((By.XPATH, f'//ul/li[text()=\"{name}\"]'))).click()\n        imp.click_button('//ul[@class=\"ivu-tree-children\"]//span[text()=\"导入\"]')\n        imp.click_impall_button(\"编辑\")\n        sleep(1)\n        imp.click_button(f'//ul[@class=\"ivu-tree-children\"]//span[text()=\"{kh}\"]/ancestor::ul[1]//label/span')\n        imp.click_button(f'//ul[@class=\"ivu-tree-children\"]//span[text()=\"{gx}\"]/ancestor::ul[1]//label/span')\n        ele = imp.get_find_element_xpath(f'//ul[@class=\"ivu-tree-children\"]//span[text()=\"{gx}\"]')\n        ActionChains(driver).context_click(ele).perform()\n        imp.click_button('//li[text()=\"映射编辑\"]')\n        imp.click_button('//button[span[text()=\"浏览文件\"]]')\n    \n        # 清理 .crdownload 文件，避免上传未完成的文件\n        current_dir = os.path.dirname(__file__)\n        download_path = os.path.join(current_dir, \"downloads\")\n        for f in os.listdir(download_path):\n            if f.endswith(\".crdownload\"):\n                os.remove(os.path.join(download_path, f))\n    \n        sleep(2)\n        # 1. 准备上传文件路径\n        upload_file = os.path.join(download_path, f\"{dir_}.xls\")\n        assert os.path.isfile(upload_file), f\"❌ 上传文件不存在: {upload_file}\"\n    \n        # 2. 定位上传控件并执行上传\n        imp.get_find_element_xpath('(//input[@type=\"file\"])[3]')\n        pyautogui.write(upload_file)\n        sleep(3)\n        pyautogui.press('enter')\n        sleep(1)\n        pyautogui.press('enter')\n        sleep(1)\n        imp.click_button('//div[text()=\" 字段映射 \"]')\n        sleep(1)\n        imp.wait_for_el_loading_mask()\n        num = len(imp.finds_elements(By.XPATH, '(//table[@class=\"vxe-table--body\"])[1]//tr'))\n        for i in range(1, num + 1):\n            imp.click_button(\n                f'(//table[@class=\"vxe-table--body\"])[1]//tr[{i}]/td[3]')\n            sleep(0.5)\n            imp.click_button(\n                f'(//div[@class=\"vxe-select-option--wrapper\"])[{i}]/div[{i}]')\n            sleep(1)\n    \n        imp.click_button(\n            '(//div[@class=\"vxe-modal--footer\"]//span[text()=\"确定\"])[last()]')\n        imp.click_impall_button(\"保存\")\n        message = imp.get_find_message()\n        imp.click_button('//span[text()=\" 执行方案\"]')\n        imp.click_button('//div[@class=\"ivu-modal-confirm-footer\"]//span[text()=\"确定\"]')\n        imp.get_find_message()\n        imp.wait_for_el_loading_mask()\n        eles1 = imp.finds_elements(By.XPATH,\n                                   f'//ul[@class=\"ivu-tree-children\"]//span[@class=\"valueSpan\" and text()=\"{kh}\"]')\n        eles2 = imp.finds_elements(By.XPATH,\n                                   f'//ul[@class=\"ivu-tree-children\"]//span[@class=\"valueSpan\" and text()=\"{gx}\"]')\n        eles = imp.finds_elements(By.XPATH, '//i[@class=\"ivu-icon ivu-icon-ios-close-circle\"]')\n        assert len(eles) == 0\n>       assert message == \"保存成功\" and len(eles1) == 0 and len(eles2) == 1\nE       assert ('\\u4fdd\\u5b58\\u6210\\u529f' == '\\u4fdd\\u5b58\\u6210\\u529f'\nE         \nE         \u001B[0m\u001B[90m \u001B[39;49;00m 保存成功\u001B[90m\u001B[39;49;00m and 2 == 0)\nE        +  where 2 = len([<selenium.webdriver.remote.webelement.WebElement (session=\"e6f445d61ee41b2708dff765542abc32\", element=\"f.DE6069D09715D71BC37C618DEE4F4204.d.02812212BC197144D6FF12E1ECFFEF55.e.19363\")>, <selenium.webdriver.remote.webelement.WebElement (session=\"e6f445d61ee41b2708dff765542abc32\", element=\"f.DE6069D09715D71BC37C618DEE4F4204.d.02812212BC197144D6FF12E1ECFFEF55.e.25490\")>])\n\nTests\\test_system\\test_imp.py:244: AssertionError","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":1,"retriesStatusChange":false,"beforeStages":[{"name":"login_to_imp","time":{"start":1770328705174,"stop":1770328722756,"duration":17582},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"attachmentStep":false,"hasContent":false,"stepsCount":0}],"testStage":{"status":"failed","statusMessage":"AssertionError: assert ('\\u4fdd\\u5b58\\u6210\\u529f' == '\\u4fdd\\u5b58\\u6210\\u529f'\n  \n  \u001B[0m\u001B[90m \u001B[39;49;00m 保存成功\u001B[90m\u001B[39;49;00m and 2 == 0)\n +  where 2 = len([<selenium.webdriver.remote.webelement.WebElement (session=\"e6f445d61ee41b2708dff765542abc32\", element=\"f.DE6069D09715D71BC37C618DEE4F4204.d.02812212BC197144D6FF12E1ECFFEF55.e.19363\")>, <selenium.webdriver.remote.webelement.WebElement (session=\"e6f445d61ee41b2708dff765542abc32\", element=\"f.DE6069D09715D71BC37C618DEE4F4204.d.02812212BC197144D6FF12E1ECFFEF55.e.25490\")>])","statusTrace":"self = <test_system.test_imp.TestImpPage object at 0x000001B938328460>, login_to_imp = <selenium.webdriver.chrome.webdriver.WebDriver (session=\"e6f445d61ee41b2708dff765542abc32\")>\n\n    @allure.story(\"编辑方案成功，取消勾选客户，勾选工序成功。右键映射点击确定不报错，点击方案不报错\")\n    # @pytest.mark.run(order=1)\n    def test_imp_update(self, login_to_imp):\n        driver = login_to_imp  # WebDriver 实例\n        imp = ImpPage(driver)  # 用 driver 初始化 ImpPage\n        dir_ = 'Process'\n        name = \"1导入设置方案\"\n        kh = \"客户\"\n        gx = \"工序\"\n        imp.click_button(\n            '//div[@class=\"flex-alignItems-center background-ffffff h-36px w-b-100 m-l-12 toolbar-container\"]//input[@class=\"ivu-select-input\"]')\n        WebDriverWait(driver, 10).until(EC.element_to_be_clickable((By.XPATH, f'//ul/li[text()=\"{name}\"]'))).click()\n        imp.click_button('//ul[@class=\"ivu-tree-children\"]//span[text()=\"导入\"]')\n        imp.click_impall_button(\"编辑\")\n        sleep(1)\n        imp.click_button(f'//ul[@class=\"ivu-tree-children\"]//span[text()=\"{kh}\"]/ancestor::ul[1]//label/span')\n        imp.click_button(f'//ul[@class=\"ivu-tree-children\"]//span[text()=\"{gx}\"]/ancestor::ul[1]//label/span')\n        ele = imp.get_find_element_xpath(f'//ul[@class=\"ivu-tree-children\"]//span[text()=\"{gx}\"]')\n        ActionChains(driver).context_click(ele).perform()\n        imp.click_button('//li[text()=\"映射编辑\"]')\n        imp.click_button('//button[span[text()=\"浏览文件\"]]')\n    \n        # 清理 .crdownload 文件，避免上传未完成的文件\n        current_dir = os.path.dirname(__file__)\n        download_path = os.path.join(current_dir, \"downloads\")\n        for f in os.listdir(download_path):\n            if f.endswith(\".crdownload\"):\n                os.remove(os.path.join(download_path, f))\n    \n        sleep(2)\n        # 1. 准备上传文件路径\n        upload_file = os.path.join(download_path, f\"{dir_}.xls\")\n        assert os.path.isfile(upload_file), f\"❌ 上传文件不存在: {upload_file}\"\n    \n        # 2. 定位上传控件并执行上传\n        imp.get_find_element_xpath('(//input[@type=\"file\"])[3]')\n        pyautogui.write(upload_file)\n        sleep(3)\n        pyautogui.press('enter')\n        sleep(1)\n        pyautogui.press('enter')\n        sleep(1)\n        imp.click_button('//div[text()=\" 字段映射 \"]')\n        sleep(1)\n        imp.wait_for_el_loading_mask()\n        num = len(imp.finds_elements(By.XPATH, '(//table[@class=\"vxe-table--body\"])[1]//tr'))\n        for i in range(1, num + 1):\n            imp.click_button(\n                f'(//table[@class=\"vxe-table--body\"])[1]//tr[{i}]/td[3]')\n            sleep(0.5)\n            imp.click_button(\n                f'(//div[@class=\"vxe-select-option--wrapper\"])[{i}]/div[{i}]')\n            sleep(1)\n    \n        imp.click_button(\n            '(//div[@class=\"vxe-modal--footer\"]//span[text()=\"确定\"])[last()]')\n        imp.click_impall_button(\"保存\")\n        message = imp.get_find_message()\n        imp.click_button('//span[text()=\" 执行方案\"]')\n        imp.click_button('//div[@class=\"ivu-modal-confirm-footer\"]//span[text()=\"确定\"]')\n        imp.get_find_message()\n        imp.wait_for_el_loading_mask()\n        eles1 = imp.finds_elements(By.XPATH,\n                                   f'//ul[@class=\"ivu-tree-children\"]//span[@class=\"valueSpan\" and text()=\"{kh}\"]')\n        eles2 = imp.finds_elements(By.XPATH,\n                                   f'//ul[@class=\"ivu-tree-children\"]//span[@class=\"valueSpan\" and text()=\"{gx}\"]')\n        eles = imp.finds_elements(By.XPATH, '//i[@class=\"ivu-icon ivu-icon-ios-close-circle\"]')\n        assert len(eles) == 0\n>       assert message == \"保存成功\" and len(eles1) == 0 and len(eles2) == 1\nE       assert ('\\u4fdd\\u5b58\\u6210\\u529f' == '\\u4fdd\\u5b58\\u6210\\u529f'\nE         \nE         \u001B[0m\u001B[90m \u001B[39;49;00m 保存成功\u001B[90m\u001B[39;49;00m and 2 == 0)\nE        +  where 2 = len([<selenium.webdriver.remote.webelement.WebElement (session=\"e6f445d61ee41b2708dff765542abc32\", element=\"f.DE6069D09715D71BC37C618DEE4F4204.d.02812212BC197144D6FF12E1ECFFEF55.e.19363\")>, <selenium.webdriver.remote.webelement.WebElement (session=\"e6f445d61ee41b2708dff765542abc32\", element=\"f.DE6069D09715D71BC37C618DEE4F4204.d.02812212BC197144D6FF12E1ECFFEF55.e.25490\")>])\n\nTests\\test_system\\test_imp.py:244: AssertionError","steps":[],"attachments":[{"uid":"c2f7ab7bb873a5e5","name":"test_imp_update_20260206_060029","source":"c2f7ab7bb873a5e5.png","type":"image/png","size":55196},{"uid":"4f1906c51b8b436f","name":"log","source":"4f1906c51b8b436f.txt","type":"text/plain","size":11555}],"parameters":[],"shouldDisplayMessage":true,"attachmentsCount":2,"attachmentStep":false,"hasContent":true,"stepsCount":0},"afterStages":[{"name":"login_to_imp::0","time":{"start":1770328884930,"stop":1770328887094,"duration":2164},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"attachmentsCount":0,"attachmentStep":false,"hasContent":false,"stepsCount":0}],"labels":[{"name":"story","value":"编辑方案成功，取消勾选客户，勾选工序成功。右键映射点击确定不报错，点击方案不报错"},{"name":"feature","value":"导入设置页用例"},{"name":"parentSuite","value":"Tests.test_system"},{"name":"suite","value":"test_imp"},{"name":"subSuite","value":"TestImpPage"},{"name":"host","value":"WIN-20240820MJV"},{"name":"thread","value":"28724-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"Tests.test_system.test_imp"},{"name":"resultFormat","value":"allure2"}],"parameters":[],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[{"uid":"ecf63a0a11e0b919","status":"failed","statusDetails":"AssertionError: assert ('\\u4fdd\\u5b58\\u6210\\u529f' == '\\u4fdd\\u5b58\\u6210\\u529f'\n  \n  \u001B[0m\u001B[90m \u001B[39;49;00m 保存成功\u001B[90m\u001B[39;49;00m and 1 == 0)\n +  where 1 = len([<selenium.webdriver.remote.webelement.WebElement (session=\"e6f445d61ee41b2708dff765542abc32\", element=\"f.DE6069D09715D71BC37C618DEE4F4204.d.02812212BC197144D6FF12E1ECFFEF55.e.19363\")>])","time":{"start":1770328766585,"stop":1770328798316,"duration":31731}}],"categories":[{"name":"Product defects","matchedStatuses":[]}],"tags":[]},"source":"649d73c283440589.json","parameterValues":[]}