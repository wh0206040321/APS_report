{"uid":"d87e611fc8f60034","name":"test_imp_update","fullName":"Tests.test_system.test_imp.TestImpPage#test_imp_update","historyId":"6c925cfdaf73b2b37df6c7fddf34649b","time":{"start":1770065366474,"stop":1770065399525,"duration":33051},"status":"failed","statusMessage":"AssertionError: assert ('\\u4fdd\\u5b58\\u6210\\u529f' == '\\u4fdd\\u5b58\\u6210\\u529f'\n  \n  \u001B[0m\u001B[90m \u001B[39;49;00m 保存成功\u001B[90m\u001B[39;49;00m and 1 == 0)\n +  where 1 = len([<selenium.webdriver.remote.webelement.WebElement (session=\"d5f3c523d69fed42a142591a06849290\", element=\"f.1E4202E1B71D7E4FD7ADB896AE015CFB.d.D3BF82A11159E2159E3FAD279DF74485.e.25512\")>])","statusTrace":"self = <test_system.test_imp.TestImpPage object at 0x000001FD2028E3B0>, login_to_imp = <selenium.webdriver.chrome.webdriver.WebDriver (session=\"d5f3c523d69fed42a142591a06849290\")>\n\n    @allure.story(\"编辑方案成功，取消勾选客户，勾选工序成功。右键映射点击确定不报错，点击方案不报错\")\n    # @pytest.mark.run(order=1)\n    def test_imp_update(self, login_to_imp):\n        driver = login_to_imp  # WebDriver 实例\n        imp = ImpPage(driver)  # 用 driver 初始化 ImpPage\n        dir_ = 'Process'\n        name = \"1导入设置方案\"\n        kh = \"客户\"\n        gx = \"工序\"\n        imp.click_button(\n            '//div[@class=\"flex-alignItems-center background-ffffff h-36px w-b-100 m-l-12 toolbar-container\"]//input[@class=\"ivu-select-input\"]')\n        WebDriverWait(driver, 10).until(EC.element_to_be_clickable((By.XPATH, f'//ul/li[text()=\"{name}\"]'))).click()\n        imp.click_button('//ul[@class=\"ivu-tree-children\"]//span[text()=\"导入\"]')\n        imp.click_impall_button(\"编辑\")\n        sleep(1)\n        imp.click_button(f'//ul[@class=\"ivu-tree-children\"]//span[text()=\"{kh}\"]/ancestor::ul[1]//label/span')\n        imp.click_button(f'//ul[@class=\"ivu-tree-children\"]//span[text()=\"{gx}\"]/ancestor::ul[1]//label/span')\n        ele = imp.get_find_element_xpath(f'//ul[@class=\"ivu-tree-children\"]//span[text()=\"{gx}\"]')\n        ActionChains(driver).context_click(ele).perform()\n        imp.click_button('//li[text()=\"映射编辑\"]')\n        imp.click_button('//button[span[text()=\"浏览文件\"]]')\n    \n        # 清理 .crdownload 文件，避免上传未完成的文件\n        current_dir = os.path.dirname(__file__)\n        download_path = os.path.join(current_dir, \"downloads\")\n        for f in os.listdir(download_path):\n            if f.endswith(\".crdownload\"):\n                os.remove(os.path.join(download_path, f))\n    \n        sleep(2)\n        # 1. 准备上传文件路径\n        upload_file = os.path.join(download_path, f\"{dir_}.xls\")\n        assert os.path.isfile(upload_file), f\"❌ 上传文件不存在: {upload_file}\"\n    \n        # 2. 定位上传控件并执行上传\n        imp.get_find_element_xpath('(//input[@type=\"file\"])[3]')\n        pyautogui.write(upload_file)\n        sleep(3)\n        pyautogui.press('enter')\n        sleep(1)\n        pyautogui.press('enter')\n        sleep(1)\n        imp.click_button('//div[text()=\" 字段映射 \"]')\n        sleep(1)\n        imp.wait_for_el_loading_mask()\n        num = len(imp.finds_elements(By.XPATH, '(//table[@class=\"vxe-table--body\"])[1]//tr'))\n        for i in range(1, num + 1):\n            imp.click_button(\n                f'(//table[@class=\"vxe-table--body\"])[1]//tr[{i}]/td[3]')\n            sleep(0.5)\n            imp.click_button(\n                f'(//div[@class=\"vxe-select-option--wrapper\"])[{i}]/div[{i}]')\n            sleep(1)\n    \n        imp.click_button(\n            '(//div[@class=\"vxe-modal--footer\"]//span[text()=\"确定\"])[last()]')\n        imp.click_impall_button(\"保存\")\n        message = imp.get_find_message()\n        imp.click_button('//span[text()=\" 执行方案\"]')\n        imp.click_button('//div[@class=\"ivu-modal-confirm-footer\"]//span[text()=\"确定\"]')\n        imp.get_find_message()\n        imp.wait_for_el_loading_mask()\n        eles1 = imp.finds_elements(By.XPATH,\n                                   f'//ul[@class=\"ivu-tree-children\"]//span[@class=\"valueSpan\" and text()=\"{kh}\"]')\n        eles2 = imp.finds_elements(By.XPATH,\n                                   f'//ul[@class=\"ivu-tree-children\"]//span[@class=\"valueSpan\" and text()=\"{gx}\"]')\n        eles = imp.finds_elements(By.XPATH, '//i[@class=\"ivu-icon ivu-icon-ios-close-circle\"]')\n        assert len(eles) == 0\n>       assert message == \"保存成功\" and len(eles1) == 0 and len(eles2) == 1\nE       assert ('\\u4fdd\\u5b58\\u6210\\u529f' == '\\u4fdd\\u5b58\\u6210\\u529f'\nE         \nE         \u001B[0m\u001B[90m \u001B[39;49;00m 保存成功\u001B[90m\u001B[39;49;00m and 1 == 0)\nE        +  where 1 = len([<selenium.webdriver.remote.webelement.WebElement (session=\"d5f3c523d69fed42a142591a06849290\", element=\"f.1E4202E1B71D7E4FD7ADB896AE015CFB.d.D3BF82A11159E2159E3FAD279DF74485.e.25512\")>])\n\nTests\\test_system\\test_imp.py:244: AssertionError","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":1,"retriesStatusChange":false,"beforeStages":[{"name":"login_to_imp","time":{"start":1770065267803,"stop":1770065286244,"duration":18441},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"hasContent":false,"attachmentStep":false,"shouldDisplayMessage":false,"attachmentsCount":0}],"testStage":{"status":"failed","statusMessage":"AssertionError: assert ('\\u4fdd\\u5b58\\u6210\\u529f' == '\\u4fdd\\u5b58\\u6210\\u529f'\n  \n  \u001B[0m\u001B[90m \u001B[39;49;00m 保存成功\u001B[90m\u001B[39;49;00m and 1 == 0)\n +  where 1 = len([<selenium.webdriver.remote.webelement.WebElement (session=\"d5f3c523d69fed42a142591a06849290\", element=\"f.1E4202E1B71D7E4FD7ADB896AE015CFB.d.D3BF82A11159E2159E3FAD279DF74485.e.25512\")>])","statusTrace":"self = <test_system.test_imp.TestImpPage object at 0x000001FD2028E3B0>, login_to_imp = <selenium.webdriver.chrome.webdriver.WebDriver (session=\"d5f3c523d69fed42a142591a06849290\")>\n\n    @allure.story(\"编辑方案成功，取消勾选客户，勾选工序成功。右键映射点击确定不报错，点击方案不报错\")\n    # @pytest.mark.run(order=1)\n    def test_imp_update(self, login_to_imp):\n        driver = login_to_imp  # WebDriver 实例\n        imp = ImpPage(driver)  # 用 driver 初始化 ImpPage\n        dir_ = 'Process'\n        name = \"1导入设置方案\"\n        kh = \"客户\"\n        gx = \"工序\"\n        imp.click_button(\n            '//div[@class=\"flex-alignItems-center background-ffffff h-36px w-b-100 m-l-12 toolbar-container\"]//input[@class=\"ivu-select-input\"]')\n        WebDriverWait(driver, 10).until(EC.element_to_be_clickable((By.XPATH, f'//ul/li[text()=\"{name}\"]'))).click()\n        imp.click_button('//ul[@class=\"ivu-tree-children\"]//span[text()=\"导入\"]')\n        imp.click_impall_button(\"编辑\")\n        sleep(1)\n        imp.click_button(f'//ul[@class=\"ivu-tree-children\"]//span[text()=\"{kh}\"]/ancestor::ul[1]//label/span')\n        imp.click_button(f'//ul[@class=\"ivu-tree-children\"]//span[text()=\"{gx}\"]/ancestor::ul[1]//label/span')\n        ele = imp.get_find_element_xpath(f'//ul[@class=\"ivu-tree-children\"]//span[text()=\"{gx}\"]')\n        ActionChains(driver).context_click(ele).perform()\n        imp.click_button('//li[text()=\"映射编辑\"]')\n        imp.click_button('//button[span[text()=\"浏览文件\"]]')\n    \n        # 清理 .crdownload 文件，避免上传未完成的文件\n        current_dir = os.path.dirname(__file__)\n        download_path = os.path.join(current_dir, \"downloads\")\n        for f in os.listdir(download_path):\n            if f.endswith(\".crdownload\"):\n                os.remove(os.path.join(download_path, f))\n    \n        sleep(2)\n        # 1. 准备上传文件路径\n        upload_file = os.path.join(download_path, f\"{dir_}.xls\")\n        assert os.path.isfile(upload_file), f\"❌ 上传文件不存在: {upload_file}\"\n    \n        # 2. 定位上传控件并执行上传\n        imp.get_find_element_xpath('(//input[@type=\"file\"])[3]')\n        pyautogui.write(upload_file)\n        sleep(3)\n        pyautogui.press('enter')\n        sleep(1)\n        pyautogui.press('enter')\n        sleep(1)\n        imp.click_button('//div[text()=\" 字段映射 \"]')\n        sleep(1)\n        imp.wait_for_el_loading_mask()\n        num = len(imp.finds_elements(By.XPATH, '(//table[@class=\"vxe-table--body\"])[1]//tr'))\n        for i in range(1, num + 1):\n            imp.click_button(\n                f'(//table[@class=\"vxe-table--body\"])[1]//tr[{i}]/td[3]')\n            sleep(0.5)\n            imp.click_button(\n                f'(//div[@class=\"vxe-select-option--wrapper\"])[{i}]/div[{i}]')\n            sleep(1)\n    \n        imp.click_button(\n            '(//div[@class=\"vxe-modal--footer\"]//span[text()=\"确定\"])[last()]')\n        imp.click_impall_button(\"保存\")\n        message = imp.get_find_message()\n        imp.click_button('//span[text()=\" 执行方案\"]')\n        imp.click_button('//div[@class=\"ivu-modal-confirm-footer\"]//span[text()=\"确定\"]')\n        imp.get_find_message()\n        imp.wait_for_el_loading_mask()\n        eles1 = imp.finds_elements(By.XPATH,\n                                   f'//ul[@class=\"ivu-tree-children\"]//span[@class=\"valueSpan\" and text()=\"{kh}\"]')\n        eles2 = imp.finds_elements(By.XPATH,\n                                   f'//ul[@class=\"ivu-tree-children\"]//span[@class=\"valueSpan\" and text()=\"{gx}\"]')\n        eles = imp.finds_elements(By.XPATH, '//i[@class=\"ivu-icon ivu-icon-ios-close-circle\"]')\n        assert len(eles) == 0\n>       assert message == \"保存成功\" and len(eles1) == 0 and len(eles2) == 1\nE       assert ('\\u4fdd\\u5b58\\u6210\\u529f' == '\\u4fdd\\u5b58\\u6210\\u529f'\nE         \nE         \u001B[0m\u001B[90m \u001B[39;49;00m 保存成功\u001B[90m\u001B[39;49;00m and 1 == 0)\nE        +  where 1 = len([<selenium.webdriver.remote.webelement.WebElement (session=\"d5f3c523d69fed42a142591a06849290\", element=\"f.1E4202E1B71D7E4FD7ADB896AE015CFB.d.D3BF82A11159E2159E3FAD279DF74485.e.25512\")>])\n\nTests\\test_system\\test_imp.py:244: AssertionError","steps":[],"attachments":[{"uid":"403ca65ad29ad0db","name":"test_imp_update_20260203_044959","source":"403ca65ad29ad0db.png","type":"image/png","size":108268},{"uid":"95daa5ea100d4e48","name":"test_imp_update_20260203_044959","source":"95daa5ea100d4e48.png","type":"image/png","size":108268},{"uid":"30fd18905abdf805","name":"test_imp_update_20260203_044959","source":"30fd18905abdf805.png","type":"image/png","size":52501},{"uid":"b915aa5bf67d23f1","name":"log","source":"b915aa5bf67d23f1.txt","type":"text/plain","size":11555}],"parameters":[],"stepsCount":0,"hasContent":true,"attachmentStep":false,"shouldDisplayMessage":true,"attachmentsCount":4},"afterStages":[{"name":"login_to_imp::0","time":{"start":1770065454090,"stop":1770065456256,"duration":2166},"status":"passed","steps":[],"attachments":[],"parameters":[],"stepsCount":0,"hasContent":false,"attachmentStep":false,"shouldDisplayMessage":false,"attachmentsCount":0}],"labels":[{"name":"feature","value":"导入设置页用例"},{"name":"story","value":"编辑方案成功，取消勾选客户，勾选工序成功。右键映射点击确定不报错，点击方案不报错"},{"name":"parentSuite","value":"Tests.test_system"},{"name":"suite","value":"test_imp"},{"name":"subSuite","value":"TestImpPage"},{"name":"host","value":"WIN-20240820MJV"},{"name":"thread","value":"44308-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"Tests.test_system.test_imp"},{"name":"resultFormat","value":"allure2"}],"parameters":[],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[{"uid":"58de6875d2cd75f2","status":"failed","statusDetails":"AssertionError: assert ('\\u4fdd\\u5b58\\u6210\\u529f' == '\\u4fdd\\u5b58\\u6210\\u529f'\n  \n  \u001B[0m\u001B[90m \u001B[39;49;00m 保存成功\u001B[90m\u001B[39;49;00m and 2 == 0)\n +  where 2 = len([<selenium.webdriver.remote.webelement.WebElement (session=\"d5f3c523d69fed42a142591a06849290\", element=\"f.1E4202E1B71D7E4FD7ADB896AE015CFB.d.D3BF82A11159E2159E3FAD279DF74485.e.20079\")>, <selenium.webdriver.remote.webelement.WebElement (session=\"d5f3c523d69fed42a142591a06849290\", element=\"f.1E4202E1B71D7E4FD7ADB896AE015CFB.d.D3BF82A11159E2159E3FAD279DF74485.e.25512\")>])","time":{"start":1770065332223,"stop":1770065366165,"duration":33942}}],"categories":[{"name":"Product defects","matchedStatuses":[]}],"tags":[]},"source":"d87e611fc8f60034.json","parameterValues":[]}